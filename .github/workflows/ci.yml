name: CI
permissions:
  contents: read

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # Quality checks for PHP 8.2 (with coverage)
  quality-checks-82:
    name: Quality Checks (PHP 8.2)
    uses: ./.github/workflows/quality-checks.yml
    with:
      php-version: '8.2'
      upload-coverage: true
  
  # Quality checks for PHP 8.3
  quality-checks-83:
    name: Quality Checks (PHP 8.3)
    uses: ./.github/workflows/quality-checks.yml
    with:
      php-version: '8.3'
      upload-coverage: false
  
  # Quality checks for PHP 8.4
  quality-checks-84:
    name: Quality Checks (PHP 8.4)
    uses: ./.github/workflows/quality-checks.yml
    with:
      php-version: '8.4'
      upload-coverage: false

  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.2.2
        
      - name: üêò Setup PHP 8.2
        uses: shivammathur/setup-php@bf6b4fbd49ca58e4608c9c89fba0b8d90bd2a39f # 2.35.5
        with:
          php-version: '8.2'
          extensions: mbstring, intl
          coverage: none
          
      - name: üì¶ Install Composer dependencies
        run: composer install --no-interaction --no-progress --optimize-autoloader
        
      - name: üîí Security audit
        run: composer audit
